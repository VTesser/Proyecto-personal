---
title: "Fase 3 - Proyecto personal"
author: "Valentina Tesser"
date: "2025-10-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = getwd())
```

# Fase 3 - Exploración descriptiva de datos de Goodreads

Preguntas de investigación: 

1. ¿Qué relación existe entre la valoración promedio de un libro y su nivel de popularidad en Goodreads? (Busca conectar el aprecio subjetivo con el número de lectores o reseñas, midiendo si los libros más calificados son también los más leídos o comentados).

2. ¿Cuáles son los géneros o etiquetas más comunes entre los libros mejor valorados por los usuarios? (Permite explorar preferencias colectivas y patrones culturales en los gustos de lectura).

3. ¿Qué características comparten los títulos que más usuarios marcan como “por leer”? (Integra la variable del archivo “to_read” para entender la anticipación lectora o el interés potencial hacia ciertos libros).

4. ¿Cómo varían las calificaciones y reseñas según el género, autor y año de publicación? (Explora diferencias sistemáticas entre tipos de libros y tendencias temporales).

Para desarrollar este analisis, iremos trabajando pregunta por pregunta: 

# PREGUNTA 1 - Explorando la relación entre valoración y popularidad en Goodreads

¿Qué relación existe entre la valoración promedio de un libro y su nivel de popularidad en Goodreads? 

Explorar si los libros que tienen mejores calificaciones promedio (avg_rating) también son los que reciben más reseñas o valoraciones (n_ratings), es decir, si existe una correlación entre popularidad y valoración. 

## Cargar la base integrada

Esta base contiene todos los libros limpios y preparados para análisis, con las siguientes variables:

- book_id: identificador único de cada libro
- authors: nombre del/los autor(es)
- original_publication_year: año de publicación original
- title / original_title: título del libro
- language_code: idioma
- average_rating: promedio de ratings de Goodreads
- ratings_count: número de calificaciones
- work_text_reviews_count: número de reseñas textuales
- tag_name: género principal (seleccionado a partir de los tags)
- avg_rating / n_ratings: promedio y cantidad de ratings agregados
- n_to_read: número de usuarios que marcaron el libro como "por leer"

```{r}
books_full <- read_csv("~/Desktop/Universidad 2025/Datos magister/Proyecto personal/Data Limpia/books_final_integrated.csv")

# Vista previa de la base
head(books_full)
dim(books_full)
colnames(books_full)

# Revisar valores NA por columna
sapply(books_full, function(x) sum(is.na(x)))

```

Observación: avg_rating contine 7474 NA, n_ratings contiene 7474 NA, n_to_read contine 7475 NA. 

Estos NA corresponden a libros sin calificaciones o sin usuarios que los marcaron como "por leer". 

Por lo tanto, en los gráficos siguientes se trabajará solo con los registros completos, utilizando `filter(!is.na(avg_rating))` y `filter(!is.na(n_ratings))` para asegurar que los resultados sean representativos.

# 1. Diagrama de dispersión: popularidad vs. valoración promedio

El siguiente gráfico muestra cómo se distribuyen los libros en función de su número de valoraciones (`n_ratings`) y su calificación promedio (`avg_rating`).


```{r}
library(ggplot2)
library(dplyr)

books_clean <- books_full %>%
  filter(!is.na(avg_rating), !is.na(n_ratings))

grafico_pop <- ggplot(books_clean, aes(x = n_ratings, y = avg_rating)) +
  geom_point(alpha = 0.4, color = "#0072B2") +
  scale_x_log10() +
  labs(
    title = "Relación entre popularidad y valoración promedio en Goodreads",
    x = "Número de valoraciones (escala logarítmica)",
    y = "Valoración promedio",
    caption = "Fuente: Dataset Goodbooks-10k (Kaggle) Visualización: Valentina Tesser"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 16)  # negrita y tamaño opcional
  )

# Guardar el gráfico 

ggsave("../Outputs/grafico_populares.png", grafico_pop, width = 10, height = 6, dpi = 300)

```


En el gráfico de dispersión, donde cada punto representa un libro, se observa una alta concentración entre las 100 y 1.000 valoraciones (recordando que el eje X está en escala logarítmica). Esto significa que la mayoría de los títulos del dataset son moderadamente populares, sin llegar a los niveles masivos de lecturas que tienen algunos best-sellers.

En cuanto a las valoraciones promedio (avg_rating), la mayoría de los libros se ubica entre 3,0 y 4,5 estrellas, lo que refleja una tendencia general positiva: los usuarios de Goodreads tienden a evaluar los libros con buenas calificaciones, aunque no con puntuaciones extremas.

También se pueden notar algunos valores atípicos —libros con muchas valoraciones pero calificaciones más bajas, o al contrario, libros con muy pocas valoraciones pero con promedios cercanos a 5 estrellas—. Esto puede deberse a fenómenos distintos: los primeros suelen ser títulos muy conocidos pero polarizantes (por ejemplo, sagas populares o libros con adaptaciones cinematográficas), mientras que los segundos suelen ser libros de nicho, leídos por pocos usuarios pero muy apreciados por ellos.

En síntesis, la concentración de puntos muestra que la mayoría de los libros tiene una recepción positiva pero una visibilidad limitada, y que la popularidad extrema es la excepción.

Igualmente, podemos ver mejor los datos en el siguiente gráfico: 


```{r}
library(plotly)
library(ggplot2)
library(dplyr)
library(scales)
library(htmlwidgets)

p <- ggplot(books_clean, aes(
  x = n_ratings,
  y = avg_rating,
  text = paste(
    "Título:", title,
    "<br>Autor:", authors,
    "<br>Valoración promedio:", round(avg_rating, 1),
    "<br>Número de valoraciones:", n_ratings
  )
)) +
  geom_point(aes(color = avg_rating), alpha = 0.6, size = 2) +
  scale_color_gradient(low = "#1ABC9C", high = "#E91E63") +
  scale_x_log10(labels = scales::comma) +
  labs(
    title = "Popularidad vs Valoración Promedio de Libros en Goodreads",
    x = "Número de valoraciones (escala logarítmica)",
    y = "Valoración promedio",
    color = "Valoración promedio",
    caption = "Fuente: Goodbooks-10k (Kaggle). Visualización: Valentina Tesser"
  ) +
  theme_minimal(base_size = 14)

# Convertir a objeto plotly
ggplotly_p <- ggplotly(p, tooltip = "text")

# Guardar como archivo HTML
saveWidget(ggplotly_p, "../Outputs/grafico_libros_interactivo.html", selfcontained = TRUE)

# Guardar una vista previa estática del gráfico
ggsave("../Outputs/grafico_libros_preview.png", plot = p, width = 8, height = 5)

```

Donde observamos la misma tendencia que en el gráfico anterior, pero con la ventaja de poder explorar cada punto individualmente al pasar el cursor sobre ellos. Esto permite identificar títulos específicos, sus autores y detalles de valoración y popularidad.


# 2. Densidad bivariada: concentración de libros

El gráfico siguiente muestra la concentración de títulos en torno a ciertos rangos de popularidad y valoración promedio.

```{r}
grafico_densidad <- ggplot(books_clean, aes(x = n_ratings, y = avg_rating)) +
  geom_bin2d(bins = 30) +
  scale_x_log10() +
  scale_fill_gradient(low = "lightblue", high = "darkblue") +
  labs(
    title = "Distribución conjunta de valoración promedio y popularidad",
    x = "Número de valoraciones (escala logarítmica)",
    y = "Valoración promedio",
    fill = "Frecuencia",
    caption = "Fuente: Dataset Goodbooks-10k (Kaggle)"
  ) +
  theme_minimal()

# Guardar el gráfico
ggsave("../Outputs/grafico_densidad_bivariada.png", grafico_densidad)

```

El gráfico de densidad bivariada muestra prácticamente la misma tendencia que el anterior, pero con una forma diferente de representación.

En lugar de mostrar puntos individuales, utiliza cuadrantes de color que representan la concentración de observaciones. Las zonas más oscuras indican donde hay más libros.

En este caso, la concentración principal también está entre 100 y 1.000 valoraciones y calificaciones promedio entre 3,5 y 4,3 estrellas, exactamente como en el gráfico anterior.

Por lo tanto, ambos gráficos entregan la misma información general, pero con distintos propósitos visuales: el diagrama de dispersión es útil para mostrar casos individuales y detectar valores atípicos. Por otro lado, el gráfico de densidad es mejor para mostrar patrones generales de concentración cuando hay muchos datos y los puntos se sobreponen.


# 3. Correlación entre valoración y popularidad

Para cuantificar la relación, calculamos la correlación de Pearson entre ambas variables:

```{r}
cor_test <- cor.test(books_clean$avg_rating, books_clean$n_ratings, use = "complete.obs")
cor_test

# Resultado:
# Pearson's correlation coefficient
# t = 7.456, df = 8128, p-value = 1
# alternative hypothesis: true correlation is not equal to 0
# 95 percent confidence interval:
# 0.065 to 0.107
# sample estimates:
# cor
# 0.086
```

Esto significa que la correlación entre la valoración promedio (avg_rating) y la popularidad (n_ratings) es positiva pero muy débil (r = 0.086).

Aunque el p-value (< 0.05) indica que la relación es estadísticamente significativa, su magnitud es tan baja que no tiene relevancia práctica fuerte.

En otras palabras, los libros más populares tienden a tener ligeramente mejores calificaciones, pero esta relación es mínima. 

Esto sugiere que la popularidad no necesariamente se explica por la calidad percibida, sino también por otros factores —como la promoción editorial, la fama del autor o la pertenencia a géneros con grandes comunidades lectoras

# 4. Los libros más populares vs. los mejor calificados

Finalmente, podemos visualizar los títulos que lideran ambos rankings y comparar si coinciden o no.

```{r}

library(dplyr)
library(ggplot2)
library(forcats)
library(stringr)
library(scales)

# Libros más populares
top_popular <- books_clean %>%
  arrange(desc(n_ratings)) %>%
  slice_head(n = 15)

# Libros mejor calificados (mínimo 1000 valoraciones)
top_rated <- books_clean %>%
  filter(n_ratings > 1000) %>%
  arrange(desc(avg_rating)) %>%
  slice_head(n = 15)

# Crear el gráfico y guardarlo en un objeto
grafico_top15 <- ggplot(top_books, aes(y = title_wrapped, x = n_ratings_plot, color = avg_rating)) +
  geom_segment(aes(x = 1, xend = n_ratings_plot, y = title_wrapped, yend = title_wrapped),
               linewidth = 1.1, alpha = 0.9) +
  geom_point(size = 4) +
  geom_text(aes(label = scales::comma(n_ratings)), hjust = -0.1, size = 3.2, color = "gray20") +
  scale_x_continuous(trans = "log10", labels = scales::comma, expand = expansion(mult = c(0.02, 0.25))) +
  scale_color_gradient(low = "#9DD9D2", high = "#00796B", name = "⭐ Valoración\npromedio") +
  labs(
    title = "Top 15 libros más populares en Goodreads",
    subtitle = "El color indica la valoración promedio; la escala X es logarítmica",
    x = "Número de valoraciones (escala log10)",
    y = "",
    caption = "Fuente: Goodbooks-10k (Kaggle). Visualización: Valentina Tesser"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
    plot.subtitle = element_text(size = 11, hjust = 0.5, color = "gray40"),
    axis.text.y = element_text(size = 10, margin = margin(r = 6)),
    legend.position = "right",
    plot.margin = margin(t = 12, r = 30, b = 12, l = 12),
    panel.grid.major.y = element_blank()
  ) +
  coord_cartesian(clip = "off")

# Guardar el gráfico en tu carpeta del proyecto
ggsave("../Outputs/grafico_top15_populares.png", grafico_top15, width = 12, height = 8, dpi = 300)

```


El gráfico ilustra el Top 15 de los libros más populares en Goodreads, ordenados por número de valoraciones. Tal como se observa, el ranking está dominado por la saga de Harry Potter, seguida por obras de Bill Bryson y Douglas Adams, entre otros títulos de alta difusión. Este resultado no sorprende: refleja el peso de las sagas literarias y autores que han trascendido el público lector, alcanzando un nivel de fenómeno cultural. 

Integrar con lo siguiente: 

El gráfico muestra los 15 libros con mayor número de valoraciones en Goodreads, utilizando una escala logarítmica para representar la cantidad de calificaciones que cada título ha recibido. El color de los puntos indica la valoración promedio otorgada por los usuarios, permitiendo comparar simultáneamente popularidad y nivel de aprobación.

Se observa que algunos títulos son ampliamente populares, acumulando cientos de miles o incluso millones de valoraciones, mientras que su promedio de calificación no siempre es el más alto. Esto sugiere que la popularidad no necesariamente refleja una mejor percepción de calidad por parte de los lectores. En cambio, existen libros con un número más moderado de valoraciones que obtienen puntuaciones notablemente superiores.

Este patrón evidencia que el interés masivo por ciertos títulos —probablemente impulsado por fenómenos editoriales, adaptaciones cinematográficas o autores reconocidos— no siempre se traduce en una evaluación más positiva. Por tanto, la popularidad en Goodreads parece estar asociada tanto a factores culturales y mediáticos como a la valoración literaria en sí misma.

En resumen, la relación entre popularidad y valoración es compleja: los libros más leídos y comentados no necesariamente son los más apreciados, lo que refleja la diversidad de gustos y expectativas dentro de la comunidad lectora de Goodreads.


## Conclusión: Valoración vs. Popularidad

El análisis revela que la relación entre la valoración promedio de un libro y su nivel de popularidad en Goodreads no es lineal ni directa. Si bien existe una tendencia general a que los libros con calificaciones más altas atraigan más lectores y reseñas, los datos muestran una amplia dispersión: muchos títulos con valoraciones promedio sobresalientes (por encima de 4.3) no alcanzan altos niveles de popularidad, mientras que otros con puntuaciones más moderadas acumulan miles de valoraciones.

Esto sugiere que la popularidad de un libro depende de múltiples factores más allá de su calidad percibida, como la visibilidad del autor, la estrategia editorial, la adaptación audiovisual o la presencia en comunidades de lectura. En resumen, una buena calificación puede ayudar, pero no garantiza el éxito masivo; el interés de los usuarios parece responder tanto a tendencias culturales como a recomendaciones externas, más que únicamente al promedio de estrellas.








